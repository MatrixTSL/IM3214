<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Digital Outputs</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>

</head>
<body>


  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-9.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 10 - Digital Outputs</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-11.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Digital outputs are how a PLC controls external devices. These could be lights, motors, relays or solenoids. In this worksheet, you'll test a variety of output devices using buttons, sensors, and the HMI. This helps you understand how PLCs activate real-world hardware in response to logic conditions.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/flow-sensor.png" alt="Flow Sensor System Maintenance">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to test digital outputs:</strong></p>

        <div class="steps-container">

          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Navigate to worksheet 10 on the HMI.</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I0 → Q0 (Momentary)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press and hold the green push button I0. Observe LED Q0 turns on only while the button is pressed.</p>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I1 Latch, I2 Reset</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press the black button I1 once and release. Q1 stays on. Press the red button I2 to turn it off.</p>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I3 Latching</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press the white latching button. Observe Q2 turns on and stays on.</p>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I4/I5 Selector → Q3</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Turn the selector switch left to turn on I4 and observe Q3 stays on. Turn right to turn on I5 and observe Q3 flashes.</p>
            </div>
          </div>

          <div class="step-card" data-step="6">
            <div class="step-number">6</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Proximity and Pot → Q4, Q5</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Trigger the proximity sensor and observe Q4. Rotate the potentiometer and observe Q5 respond.</p>
            </div>
          </div>

                <div class="step-card" data-step="7">
            <div class="step-number">7</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Dance Mode</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Set all inputs back to off. Press the “Dance Mode” button on the HMI and observe all 6 LEDs sequence.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Why this matters</h3>
          </div>
          <div class="card-content">
            <p>As a maintenance apprentice, understanding digital outputs is essential. Outputs are what actually make things happen: starting motors, energising relays, activating solenoids, opening valves, or turning on lamps. Recognising output sequences is valuable because many industrial processes rely on timed events.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-bolt"></i>
            <h3>What drives outputs</h3>
          </div>
          <div class="card-content">
            <p>Outputs turn on from buttons, selector switches, sensors, timers, or logic in the PLC. The HMI can also command outputs. Use the IO page to confirm which input caused the change.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-list-ol"></i>
            <h3>Sequences and safety</h3>
          </div>
          <div class="card-content">
            <p>Many machines run outputs in a sequence. Know the expected order so you can spot when one step fails. Safety events (like E‑Stop) should force outputs off immediately.</p>
          </div>
        </div>
      </div>

    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>PLCs use digital outputs to control devices like lights, motors, and valves.</li>
        <li>Outputs can be triggered by buttons, switches, sensors, or analogue signals.</li>
        <li>Latching and selector switches show different output behaviours.</li>
        <li>Sensors like proximity and analogue inputs can drive outputs.</li>
        <li>Sequences (“dance mode”) mirror real process timing patterns.</li>
      </ul>
    </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What does a flow sensor measure and why is it important in automated systems?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) It measures fluid movement and helps regulate flow, which is critical for system reliability, detecting faults, and maintaining performance</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) It measures temperature and controls heating</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) It measures pressure and controls valves</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) It measures level and controls pumps</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) It measures fluid movement and helps regulate flow, which is critical for system reliability, detecting faults, and maintaining performance.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: How does a turbine flow sensor work?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) It uses a spinning rotor, and the number of spins (pulses) is counted to determine the flow rate</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) It uses a magnetic field to measure flow</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) It uses ultrasonic waves to measure flow</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) It uses pressure difference to measure flow</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) It uses ultrasonic waves to measure flow.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: What role does the PLC play in reading the flow sensor data?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) The PLC counts pulses from the turbine sensor and calculates the flow rate, which is shown on the HMI</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) The PLC controls the flow sensor directly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) The PLC provides power to the flow sensor</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) The PLC calibrates the flow sensor</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) The PLC controls the flow sensor directly.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: What might unstable or incorrect flow readings indicate?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) They could indicate blockages, valve restrictions, air pockets, sensor faults, or wiring issues</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) They indicate the system is working perfectly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) They indicate the flow rate is too high</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) They indicate the temperature is too high</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) They indicate the temperature is too high.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: Why is regular calibration of flow sensors important?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) Calibration ensures the sensor remains accurate over time and helps prevent false readings or system faults</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) Calibration makes the sensor work faster</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) Calibration reduces energy consumption</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) Calibration makes the sensor quieter</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) To ensure accurate flow measurements and system performance.
          </div>
        </div>
      </div>
    </div>

    <!-- Simulation Section -->
    <div class="simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> 3. Interactive Flow Sensor System Maintenance</h2>
      <div id="flow-sensor-panel" class="simulation-container">
        <div class="simulation-loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading flow sensor simulation...</p>
          </div>
        </div>

        <!-- Key Learning Points Card -->
        <div class="key-points-card">
          <div class="card-header">
            <i class="fas fa-lightbulb"></i>
            <h3>Key Learning Points</h3>
          </div>
          <div class="key-points-grid">
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-cogs"></i>
              </div>
              <div class="key-point-content">
                <strong>Simulation will initialize automatically</p>
        </div>
      </div>
    </div>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="flow-sensor-simulation.js"></script>
  
  <script>
    // Define correct answers for worksheet 10
    const correctAnswers = {
      "1": "A",
      "2": "C",
      "3": "B",
      "4": "D",
      "5": "B"
    };

    function submitAnswer(questionNumber) {
      const questionItem = document.querySelector(`[data-question="${questionNumber}"]`);
      if (!questionItem) return;
      
      const selectedOption = questionItem.querySelector('.option-radio:checked');
      if (!selectedOption) {
        alert('Please select an answer before submitting.');
        return;
      }
      
      const answer = selectedOption.value;
      
      // Save with enhanced tracking
      worksheetTracker.saveAnswer(10, questionNumber, answer, 'maintenance');
      
      // Apply visual feedback
      const allOptions = questionItem.querySelectorAll('.option-label');
      const correctAnswer = correctAnswers[questionNumber];
      
      allOptions.forEach(option => {
        const radio = option.querySelector('.option-radio');
        const optionValue = radio.value;
        
        if (optionValue === correctAnswer) {
          option.classList.add('correct');
        } else if (optionValue === answer && answer !== correctAnswer) {
          option.classList.add('incorrect');
        }
      });
      
      // Mark question as submitted to disable further interaction
      questionItem.classList.add('submitted');
      
      // Update submit button
      const button = questionItem.querySelector('.submit-question-btn');
      const originalText = button.textContent;
      button.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
      button.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
      
      // Add incorrect class for enhanced styling
      if (answer !== correctAnswer) {
        button.classList.add('incorrect');
      }
      
      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = '#4CAF50';
        button.classList.remove('incorrect');
      }, 2000);

      // Show correct answer
      const correctAnswerDiv = questionItem.querySelector('.correct-answer');
      if (correctAnswerDiv) {
        correctAnswerDiv.style.display = 'block';
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize tracking system
      if (typeof worksheetTracker === 'undefined') {
        console.error('Worksheet tracking system not loaded');
        return;
      }

      // Load any saved answers
      const progress = worksheetTracker.getWorksheetProgress(10, 'maintenance');
      if (progress && progress.answers) {
        Object.entries(progress.answers).forEach(([questionNumber, answerData]) => {
          const questionItem = document.querySelector(`[data-question="${questionNumber}"]`);
          if (questionItem) {
            const radio = questionItem.querySelector(`.option-radio[value="${answerData.value}"]`);
            if (radio) {
              radio.checked = true;
              // Show the correct answer for previously answered questions
              const correctAnswerDiv = questionItem.querySelector('.correct-answer');
              if (correctAnswerDiv) {
                correctAnswerDiv.style.display = 'block';
              }
            }
          }
        });
      }
    });
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-9.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
       <div class="worksheet-header-center">
       <h1 class="worksheet-title">Worksheet 10 - Digital Outputs</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-11.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetter = correctAnswerText.match(/^[A-D]/);
  const isCorrect = correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Don't toggle if clicking directly on the checkbox
          if (e.target === checkbox || e.target.closest('.step-checkbox')) {
            return;
          }
          
          // Toggle the checkbox
          checkbox.checked = !checkbox.checked;
          
          // Trigger change event
          const changeEvent = new Event('change', { bubbles: true });
          checkbox.dispatchEvent(changeEvent);
          
          console.log('Checkbox toggled to:', checkbox.checked);
        });
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 