<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix PLC LOGO! Module - Basic Outputs</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <link rel="manifest" href="manifest.json">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>
  <style>
    /* Enhanced step card styling for better clickability */
    .step-card {
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      position: relative !important;
      overflow: hidden !important;
      background: #333 !important;
    }
    
    .step-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3) !important;
      border-color: var(--accent-color) !important;
      background: #3a3a3a !important;
    }
    
    .step-card:active {
      transform: translateY(0px) !important;
      box-shadow: 0 2px 8px rgba(74, 158, 255, 0.2) !important;
    }
    
    .step-card.step-completed {
      background: #2a2a2a !important;
      opacity: 0.7 !important;
      cursor: default !important;
      border-left-color: #666 !important;
    }
    
    .step-card.step-completed:hover {
      transform: none !important;
      box-shadow: none !important;
      background: #2a2a2a !important;
    }
    
    /* Loading indicator styling */
    .json-loading-indicator {
      padding: 20px;
      text-align: center;
      color: #4a9eff;
      font-size: 16px;
    }
    
    .json-loading-indicator i {
      margin-right: 10px;
    }
  </style>

</head>
<body>
  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='CP6211-worksheets.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Worksheets</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 1 - Basic Outputs</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-2.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>PLCs have different types of outputs designed for different applications. Understanding the difference between transistor outputs and relay outputs is crucial for selecting the right output type for your application.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/ws1.png" alt="PLC Output Types">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to explore PLC outputs:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Build the Circuit</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Build the circuit shown in the diagram. Connect different loads to both transistor outputs and relay outputs.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Load Program 1</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Load the program for testing different output types. This program will activate both types of outputs so you can observe their behavior.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Transistor Outputs</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Test the transistor outputs with low-current devices like LEDs or control inputs. Notice how they switch quickly and handle low-current loads.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Relay Outputs</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Test the relay outputs with higher-current devices. You should hear the relays clicking as they switch, and they can handle much higher currents.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Compare Performance</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Compare the switching speed and load capabilities of both output types. Consider which is better for different applications.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="worksheet-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-microchip"></i>
            <h3>Transistor Outputs</h3>
          </div>
          <div class="card-content">
            <p>Transistor outputs are fast-switching, low-current outputs ideal for driving signals to other control devices, LEDs, and low-power loads. They can switch very rapidly but are limited in current capacity.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-bolt"></i>
            <h3>Relay Outputs</h3>
          </div>
          <div class="card-content">
            <p>Relay outputs are robust, high-current outputs perfect for driving motors, solenoids, pumps, and other industrial loads. They provide electrical isolation but switch more slowly than transistor outputs.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-shield-alt"></i>
            <h3>Safety Considerations</h3>
          </div>
          <div class="card-content">
            <p>Always check voltage and current ratings before connecting loads. Relays provide isolation between control and power circuits, making them safer for high-power applications.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>Transistor outputs are fast-switching and ideal for low-current control applications.</li>
        <li>Relay outputs can handle higher currents and provide electrical isolation.</li>
        <li>Choose the output type based on your load requirements and switching speed needs.</li>
        <li>Always verify voltage and current ratings before connecting equipment.</li>
        <li>Understanding output capabilities is essential for industrial maintenance and troubleshooting.</li>
      </ul>
    </div>

    <!-- Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="json-loading-indicator">
        <i class="fas fa-spinner fa-spin"></i> Loading questions from JSON...
      </div>
      <div class="questions-content">
        <!-- Questions will be dynamically loaded from JSON -->
      </div>
    </div>

  </div>

  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='CP6211-worksheets.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Back to Worksheets</span>
        </button>
      </div>
      <div class="worksheet-header-center">
        <h1 class="worksheet-title">Worksheet 1 - Basic Outputs</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-2.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
<script>
// Embedded JSON data to avoid CORS issues with file:// protocol
const worksheetJSONData = {
  "worksheet": {
    "id": 1,
    "title": "PLC Outputs",
    "description": "Understanding PLC output types and their applications",
    "course": "CP6211 Industrial Maintenance",
    "module": "Matrix PLC LOGO! Module (IM3214)",
    "topic": "PLC Outputs - Transistor vs Relay",
    "questions": [
      {
        "id": 1,
        "question": "What are the two main types of PLC outputs?",
        "options": [
          {
            "key": "A",
            "text": "Low-current transistor outputs and high-current relay outputs"
          },
          {
            "key": "B", 
            "text": "Digital and analog outputs"
          },
          {
            "key": "C",
            "text": "AC and DC outputs"
          },
          {
            "key": "D",
            "text": "Input hello output signals"
          }
        ],
        "correctAnswer": "A",
        "correctAnswerText": "Low-current transistor outputs and high-current relay outputs",
        "explanation": "PLCs typically have two main output types: transistor outputs for low-current control signals and relay outputs for higher-current loads."
      },
      {
        "id": 2,
        "question": "What are transistor outputs best suited for?",
        "options": [
          {
            "key": "A",
            "text": "Driving high-power motors"
          },
          {
            "key": "B",
            "text": "Driving signals to other control devices"
          },
          {
            "key": "C", 
            "text": "Operating heavy machinery"
          },
          {
            "key": "D",
            "text": "Powering indicator beacons"
          }
        ],
        "correctAnswer": "B",
        "correctAnswerText": "Driving signals to other control devices",
        "explanation": "Transistor outputs are ideal for sending control signals to other devices due to their fast switching and low current capabilities."
      },
      {
        "id": 3,
        "question": "Why are relay outputs preferred for driving loads like pumps and solenoids?",
        "options": [
          {
            "key": "A",
            "text": "They are faster than transistor outputs"
          },
          {
            "key": "B",
            "text": "They are more accurate"
          },
          {
            "key": "C",
            "text": "They are robust and can handle higher current"
          },
          {
            "key": "D",
            "text": "They consume less power"
          }
        ],
        "correctAnswer": "C", 
        "correctAnswerText": "They are robust and can handle higher current",
        "explanation": "Relay outputs can handle higher currents and are more robust for driving inductive loads like pumps and solenoids."
      },
      {
        "id": 4,
        "question": "What is a key benefit of relays in control circuits?",
        "options": [
          {
            "key": "A",
            "text": "They increase signal speed"
          },
          {
            "key": "B", 
            "text": "They provide electrical isolation between control and power circuits"
          },
          {
            "key": "C",
            "text": "They reduce system complexity"
          },
          {
            "key": "D",
            "text": "They eliminate the need for maintenance"
          }
        ],
        "correctAnswer": "B",
        "correctAnswerText": "They provide electrical isolation between control and power circuits",
        "explanation": "Relays provide galvanic isolation between the low-voltage control circuit and the higher-voltage power circuit, improving safety."
      },
      {
        "id": 5,
        "question": "What should you always check before connecting equipment to PLC outputs?",
        "options": [
          {
            "key": "A",
            "text": "The color of the wires"
          },
          {
            "key": "B",
            "text": "The brand of the equipment"
          },
          {
            "key": "C",
            "text": "The voltage and current ratings"
          },
          {
            "key": "D",
            "text": "The installation date"
          }
        ],
        "correctAnswer": "C",
        "correctAnswerText": "The voltage and current ratings", 
        "explanation": "Always verify that the equipment's voltage and current requirements match the PLC output specifications to prevent damage."
      }
    ],
    "metadata": {
      "totalQuestions": 5,
      "questionType": "multiple-choice",
      "passingScore": 80,
      "timeEstimate": "15-20 minutes",
      "difficulty": "beginner",
      "tags": ["PLC", "outputs", "transistor", "relay", "industrial maintenance"]
    }
  }
};

// Enhanced initialization for embedded JSON questions
document.addEventListener('DOMContentLoaded', function() {
  console.log('Initializing embedded JSON-based worksheet...');
  
  try {
    // Use embedded JSON data instead of fetching
    const worksheetData = worksheetJSONData;
    const questions = worksheetData.worksheet.questions;
    
    // Hide loading indicator
    const loadingIndicator = document.querySelector('.json-loading-indicator');
    if (loadingIndicator) {
      loadingIndicator.style.display = 'none';
    }
    
    // Render questions directly
    renderQuestions(questions, worksheetData);
    
    console.log('JSON questions loaded successfully!');
    console.log('Worksheet Data:', worksheetData.worksheet.title);
    console.log('Total Questions:', worksheetData.worksheet.questions.length);
    
  } catch (error) {
    console.error('Failed to load embedded questions:', error);
    
    // Show error message
    const loadingIndicator = document.querySelector('.json-loading-indicator');
    if (loadingIndicator) {
      loadingIndicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error loading questions: ' + error.message;
      loadingIndicator.style.color = '#f44336';
    }
  }
  
  // Initialize step tracking
  initializeStepTracking();
});

// Render questions function
function renderQuestions(questions, worksheetData) {
  const container = document.querySelector('.questions-content');
  if (!container) {
    console.error('Questions container not found');
    return;
  }

  // Clear existing content
  container.innerHTML = '';

  // Render each question
  questions.forEach((question) => {
    const questionHTML = generateQuestionHTML(question);
    container.insertAdjacentHTML('beforeend', questionHTML);
  });
}

// Generate HTML for a single question
function generateQuestionHTML(question) {
  const optionsHTML = question.options.map(option => `
    <label class="option-label">
      <input type="radio" name="question-${question.id}" value="${option.key}" class="option-radio">
      <span class="option-text">${option.key}) ${option.text}</span>
    </label>
  `).join('');

  return `
    <div class="question-item" data-question="${question.id}">
      <h4>Question ${question.id}: ${question.question}</h4>
      <div class="multiple-choice-options">
        ${optionsHTML}
      </div>
      <div class="question-actions">
        <button class="submit-question-btn" onclick="submitAnswer(${question.id})">Submit Answer</button>
      </div>
      <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
        <strong style="color: #4CAF50;">Correct Answer:</strong> ${question.correctAnswerText}
        ${question.explanation ? `<br><br><em>Explanation:</em> ${question.explanation}` : ''}
      </div>
    </div>
  `;
}

// Submit answer function
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  const question = worksheetJSONData.worksheet.questions.find(q => q.id === questionNumber);
  
  if (!question) {
    console.error('Question not found:', questionNumber);
    return;
  }
  
  // Save with enhanced tracking
  if (typeof worksheetTracker !== 'undefined') {
    worksheetTracker.saveAnswer(worksheetJSONData.worksheet.id, questionNumber, answer, 'maintenance');
  }
  
  // Check if the answer is correct
  const isCorrect = question.correctAnswer === answer;
  
  // Show the correct answer
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
  
  // Disable all options for this question
  const allOptions = answerInput.querySelectorAll('input[type="radio"]');
  allOptions.forEach(option => option.disabled = true);
  
  // Hide the submit button
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.style.display = 'none';
  }
  
  // Update tracking
  if (typeof worksheetTracker !== 'undefined') {
    worksheetTracker.setQuestionCompleted(worksheetJSONData.worksheet.id, questionNumber, isCorrect);
  }
  
  // Provide visual feedback
  showAnswerFeedback(answerInput, isCorrect);
  
  console.log(`Question ${questionNumber}: ${isCorrect ? 'Correct' : 'Incorrect'} (Answer: ${answer}, Correct: ${question.correctAnswer})`);
}

// Show visual feedback for answer submission
function showAnswerFeedback(questionElement, isCorrect) {
  const feedbackClass = isCorrect ? 'answer-correct' : 'answer-incorrect';
  questionElement.classList.add(feedbackClass);
  
  // Add temporary border color
  questionElement.style.borderLeft = `4px solid ${isCorrect ? '#4CAF50' : '#f44336'}`;
  questionElement.style.backgroundColor = isCorrect ? 'rgba(76, 175, 80, 0.1)' : 'rgba(244, 67, 54, 0.1)';
  
  // Remove feedback after animation
  setTimeout(() => {
    questionElement.style.backgroundColor = '';
  }, 2000);
}

// Step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      if (checkbox) {
        let isProcessing = false;
        
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
          card.style.background = '#2a2a2a';
          card.style.opacity = '0.7';
          card.style.cursor = 'default';
        }
        
        // Checkbox change handler
        function handleCheckboxChange() {
          if (checkbox.checked) {
            card.classList.add('step-completed');
            card.style.background = '#2a2a2a';
            card.style.opacity = '0.7';
            card.style.cursor = 'default';
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            card.style.background = '';
            card.style.opacity = '';
            card.style.cursor = 'pointer';
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        }
        
        // Add event listeners
        checkbox.addEventListener('change', handleCheckboxChange);
        
        card.addEventListener('click', function(e) {
          if (isProcessing || e.target === checkbox || e.target.closest('.step-checkbox')) {
            return;
          }
          
          e.preventDefault();
          e.stopPropagation();
          
          isProcessing = true;
          checkbox.checked = !checkbox.checked;
          handleCheckboxChange();
          
          setTimeout(() => {
            isProcessing = false;
          }, 100);
        });
      }
    });
  }, 100);
}

// Utility functions
function getUrlParameter(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

function getWorksheetIdFromUrl() {
  const match = window.location.pathname.match(/worksheet-(\d+)/);
  return match ? parseInt(match[1]) : 1;
}

function saveAnswer(questionNumber, answer) {
  localStorage.setItem(`worksheet-1-question-${questionNumber}`, answer);
}
</script>
</body>
</html>
