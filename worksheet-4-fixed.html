<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Basic Inputs</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <link rel="manifest" href="manifest.json">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>

</head>
<body>
  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-3.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 4 - Basic Inputs</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-5.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Industrial sensors come in two main types: analogue and digital. Digital sensors provide simple on/off signals (24V or 0V), while analogue sensors provide variable voltage signals. Understanding sensor types is crucial for proper installation, troubleshooting, and maintenance.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/ws4.png" alt="Digital Input Sensors">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to explore different digital input types:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Build the Digital Input System</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Build the system shown in the diagram. Connect different digital sensors to explore how they provide on/off signals to the controller.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Load Program 4</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Load the basic inputs program onto your controller. This program reads the digital inputs and displays their status on the LED outputs.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Different Sensor Types</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Test pushbuttons, proximity switches, and other digital sensors. Observe how each provides a clear on/off signal to the controller inputs.</p>
              </div>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-content">
              <div class="step-header">
                <h4>Monitor Input States</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="step-checkmark"></span>
                </label>
              </div>
              <div class="step-description">
                <p>Watch the controller display to see the input states change from 0V to 24V as you activate different sensors. Note the clear digital switching behavior.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="worksheet-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Digital vs Analogue Sensors</h3>
          </div>
          <div class="card-content">
            <p>Digital sensors provide simple on/off signals (24V or 0V) and are ideal for detecting presence, position, or threshold conditions. They're reliable, easy to troubleshoot, and commonly used in industrial automation.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-bolt"></i>
            <h3>Input Types and Compatibility</h3>
          </div>
          <div class="card-content">
            <p>Always check the input type before connecting or replacing a sensor to avoid signal errors. Digital inputs typically operate at 24V DC and provide clear on/off states. Some modern controllers have configurable inputs that can be set as either digital or analogue depending on the application requirements.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-list-ol"></i>
            <h3>Common Digital Sensors</h3>
          </div>
          <div class="card-content">
            <p>Proximity switches, pushbuttons, limit switches, photoelectric sensors, and magnetic switches are all examples of digital sensors commonly found in industrial systems. Each has specific applications and installation requirements.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>Industrial sensors are classified as either analogue (variable) or digital (on/off).</li>
        <li>Digital sensors provide 24V DC when active and 0V when inactive.</li>
        <li>Sensor type compatibility must be checked before installation or replacement.</li>
        <li>Digital inputs are ideal for detecting presence, position, or threshold conditions.</li>
        <li>Common digital sensors include proximity switches, pushbuttons, and photoelectric sensors.</li>
      </ul>
    </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What are the two main types of industrial sensors?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) Large and small sensors</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) Analogue and digital sensors</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) Fast and slow sensors</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) Expensive and cheap sensors</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) Analogue and digital sensors.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: What voltage levels do digital sensors typically provide?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) 0V to 10V variable</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) 110V AC constant</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) 24V DC when active, 0V when inactive</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) 230V AC when active</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) 24V DC when active, 0V when inactive.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: Why is it important to check sensor type compatibility before installation?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) To avoid signal errors and ensure proper operation</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) To save money on installation costs</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) To make the system look better</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) To comply with building codes</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To avoid signal errors and ensure proper operation.
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    // Initialize everything when the DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
    });
    
        function submitAnswer(questionNumber) {
          const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
          if (!answerInput) return;
          
          const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
          if (!selectedOption) {
            alert('Please select an answer before submitting.');
            return;
          }
          
          const answer = selectedOption.value;
          
          // Save with enhanced tracking
          worksheetTracker.saveAnswer(4, questionNumber, answer, 'maintenance');
          
          // Define correct answers for worksheet 4
          const correctAnswers = {
            1: 'B',
            2: 'C',
            3: 'A'
          };
          
          // Check if the answer is correct
          const isCorrect = correctAnswers[questionNumber] === answer;
          
          // Show the correct answer
          const correctAnswerDiv = answerInput.querySelector('.correct-answer');
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
          
          // Disable all options for this question
          const allOptions = answerInput.querySelectorAll('input[type="radio"]');
          allOptions.forEach(option => option.disabled = true);
          
          // Hide the submit button
          const submitBtn = answerInput.querySelector('.submit-question-btn');
          if (submitBtn) {
            submitBtn.style.display = 'none';
          }
          
          // Update tracking
          worksheetTracker.setQuestionCompleted(4, questionNumber, isCorrect);
          
          console.log(`Question ${questionNumber}: ${isCorrect ? 'Correct' : 'Incorrect'}`);
        }
        
        function loadSavedAnswers() {
          // This function is now handled by the tracking system
        }
  </script>
  
<script>
// Enhanced step tracking functionality
let isProcessing = false;

function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Wait for DOM to be fully ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found step cards:', stepCards.length);
    
    stepCards.forEach((card, index) => {
      const stepNumber = index + 1;
      const checkbox = card.querySelector('.step-complete-checkbox');
      
      if (!checkbox) {
        console.log('No checkbox found for step', stepNumber);
        return;
      }
      
      console.log('Setting up step', stepNumber);
      
      // Load saved state
      const savedState = localStorage.getItem(`step-${stepNumber}`);
      if (savedState === 'true') {
        checkbox.checked = true;
        card.classList.add('step-completed');
        card.style.background = '#2a2a2a';
        card.style.opacity = '0.7';
        card.style.cursor = 'default';
      }
      
      // Enhanced checkbox change handler
      function handleCheckboxChange(checkbox, card, stepNumber) {
        console.log('Handling checkbox change for step', stepNumber, checkbox.checked);
        
        if (checkbox.checked) {
          card.classList.add('step-completed');
          card.style.background = '#2a2a2a';
          card.style.opacity = '0.7';
          card.style.cursor = 'default';
          localStorage.setItem(`step-${stepNumber}`, 'true');
        } else {
          card.classList.remove('step-completed');
          card.style.background = '';
          card.style.opacity = '';
          card.style.cursor = 'pointer';
          localStorage.setItem(`step-${stepNumber}`, 'false');
        }
      }
      
      // Add change handler to checkbox
      checkbox.addEventListener('change', function() {
        if (!isProcessing) {
          handleCheckboxChange(checkbox, card, stepNumber);
        }
      });
      
      // Add click handler to the entire card
      card.addEventListener('click', function(e) {
        console.log('Card clicked:', stepNumber);
        
        // Prevent double execution
        if (isProcessing) {
          console.log('Already processing, ignoring click');
          return;
        }
        
        // Don't toggle if clicking directly on the checkbox or its label
        if (e.target === checkbox || 
            e.target.closest('.step-checkbox') || 
            e.target.closest('label') ||
            e.target.tagName === 'INPUT' ||
            e.target.tagName === 'LABEL') {
          console.log('Clicking on checkbox or label, not toggling card');
          return;
        }
        
        // Prevent the default checkbox behavior and stop propagation
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        // Set processing flag
        isProcessing = true;
        
        // Toggle the checkbox directly without triggering events
        checkbox.checked = !checkbox.checked;
        
        // Handle the change manually
        handleCheckboxChange(checkbox, card, stepNumber);
        
        // Reset processing flag after a small delay
        setTimeout(() => {
          isProcessing = false;
        }, 100);
      });
      
      // Also make the checkbox itself clickable
      checkbox.addEventListener('click', function(e) {
        e.stopPropagation();
        e.stopImmediatePropagation();
      });
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);

</script>
</body>
</html>
