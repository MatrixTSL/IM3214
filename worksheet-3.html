<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Pulse Width Modulation</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <link rel="manifest" href="manifest.json">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>
  
  <!-- Local styles for Worksheet 3 image responsiveness -->
  <style>
    /* 4-column layout fix for introduction section */
    .introduction-content-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 20px;
      align-items: start;
    }
    
    .introduction-text {
      grid-column: 1 / 3;
    }
    
    .introduction-image {
      grid-column: 3 / 5;
      overflow: hidden;
      border-radius: 8px;
      padding: 10px;
      box-sizing: border-box;
    }
    
    .introduction-image .system-diagram {
      overflow: hidden;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .introduction-image .system-diagram img {
      width: 100% !important;
      max-width: 100% !important;
      height: auto !important;
      max-height: 300px !important;
      object-fit: contain;
      border-radius: 8px;
    }
    
    .worksheet-image-container {
      margin: 20px 0;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 15px;
      border: 1px solid rgba(58, 140, 230, 0.2);
    }
    
    .worksheet-image {
      max-width: 100%;
      height: auto;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: block;
      margin: 0 auto;
    }
    
    .image-caption {
      margin-top: 10px;
      font-size: 0.9em;
      color: #cccccc;
      font-style: italic;
      text-align: center;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .worksheet-image-container {
        margin: 15px 0;
        padding: 10px;
      }
      
      .worksheet-image {
        max-width: 95%;
      }
      
      .image-caption {
        font-size: 0.85em;
      }
    }
    
    @media (max-width: 480px) {
      .worksheet-image-container {
        margin: 10px 0;
        padding: 8px;
      }
      
      .worksheet-image {
        max-width: 100%;
      }
      
      .image-caption {
        font-size: 0.8em;
      }
    }
  </style>

</head>
<body>
  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-2.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 3 - Pulse Width Modulation</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-4.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Pulse Width Modulation (PWM) is a technique used to control the speed of motors and brightness of lights by rapidly switching the output on and off. Instead of varying voltage directly, PWM changes the ratio of 'on' time to 'off' time (called duty cycle) to control the average power delivered to the load. This efficient method is widely used in industrial automation for motor speed control and lighting systems.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/worksheets/ws3.png" alt="PWM System">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>This worksheet has two parts. Complete Part 1 first, then move to Part 2:</strong></p>
        
        <!-- Part 1 -->
        <div class="part-section">
          <h3 class="part-header"><i class="fas fa-play-circle"></i> Part 1: Basic PWM with LEDs</h3>
          <p><strong>Follow these steps to explore basic PWM control:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Build the PWM System</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Connect two motors or LED outputs to your Matrix PLC LOGO! Module. Use outputs Q1 and Q2 to demonstrate PWM control on different outputs simultaneously.</p>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Load Program 3</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Use LOGO! Soft Comfort to load Program 3 into your PLC. This program enables PWM on Output 1 and demonstrates variable duty cycle control.</p>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Observe PWM Ramping</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Watch as the program ramps the duty cycle from 'fully off' (0%) to 'fully on' (100%) in small steps over a 10-second period. Observe how this affects the connected load.</p>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Monitor Output 2</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Observe the same PWM ramping process on Output 2. Notice how both outputs can be controlled independently with different PWM parameters.</p>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Check PWM Status</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Use the LOGO! PLC's screen to view the status of each output and monitor the current PWM percentage in real-time as the duty cycle changes.</p>
            </div>
          </div>

          <div class="step-card" data-step="6">
            <div class="step-number">6</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test with Motor</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>If available, connect a motor through a FET to Output 2 and observe how PWM controls motor speed. Compare the functionality with LED control.</p>
            </div>
          </div>
        </div>
        </div>
        
        <!-- Part 2 -->
        <div class="part-section">
          <h3 class="part-header"><i class="fas fa-cogs"></i> Part 2: Motor Control with FET</h3>
          <p><strong>Now let's explore motor control using Field Effect Transistors (FETs):</strong></p>

          <!-- Part 2 Image -->
          <div class="worksheet-image-container">
            <img src="assets/worksheets/ws3-1.png" alt="Worksheet 3 Part 2 - Motor Control with FET Circuit" class="worksheet-image">
            <p class="image-caption">Motor control circuit using FET for current amplification</p>
          </div>

        <div class="steps-container">
          <div class="step-card" data-step="7">
            <div class="step-number">7</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Modify the Circuit</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Modify your circuit so that Output 2 feeds a FET (Field Effect Transistor) connected to a motor. This creates a current amplification stage between the PLC output and the motor.</p>
            </div>
          </div>

          <div class="step-card" data-step="8">
            <div class="step-number">8</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Motor Control</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Run the same PWM program and observe how the motor responds to the duty cycle changes. Notice any differences in behavior compared to LED control.</p>
            </div>
          </div>

          <div class="step-card" data-step="9">
            <div class="step-number">9</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Compare Functionality</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Is there any difference in the functionality of the program when controlling a motor vs. an LED? Observe the motor's response to different duty cycles.</p>
            </div>
          </div>

          <div class="step-card" data-step="10">
            <div class="step-number">10</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Monitor Current Draw</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>If possible, monitor the current draw of the motor at different duty cycles. Notice how the FET amplifies the small PLC output current to drive the larger motor current.</p>
            </div>
          </div>
        </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <!-- Main Explanation Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Why PWM Matters</h3>
          </div>
          <div class="card-content">
            <p>Motor speed is rarely adjusted by changing the supply voltage directly. Instead, control is achieved by pulsing the output rapidly and adjusting the ratio of 'on' time to 'off' time. This technique, known as Pulse Width Modulation (PWM), is efficient and widely used for controlling motors, lighting, and other variable loads. In many systems, PWM signals are also used as control inputs to variable frequency drives (VFDs), which then regulate motor speed more precisely.</p>
          </div>
    </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-display"></i>
            <h3>How PWM Works</h3>
          </div>
          <div class="card-content">
            <p>PWM works by switching the output on and off very quickly. The percentage of time the output is 'on' versus 'off' determines the average power delivered to the load. A 50% duty cycle means the output is on half the time and off half the time, delivering 50% of the full power to the connected device.</p>
          </div>
        </div>

        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-triangle-exclamation"></i>
            <h3>Industrial Applications</h3>
          </div>
          <div class="card-content">
            <p>PWM is essential in industrial automation for variable speed motor control, LED dimming, heating element control, and servo positioning. It provides precise control while maintaining high efficiency, making it ideal for energy-conscious applications.</p>
          </div>
        </div>

        <!-- New FET and Motor Control Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-microchip"></i>
            <h3>FETs and Motor Control</h3>
          </div>
          <div class="card-content">
            <p>FETs (Field Effect Transistors) are useful current amplifiers. When a controller needs to switch larger currents quickly, external transistor drivers like FETs are needed. Transistors switch much faster than relays and can handle the rapid switching required for PWM. The motor outputs of controllers are typically either simple FETs or a grid of FETs that can both sink and source current. Understanding the internal circuitry of your controller is essential to understand its capabilities.</p>
          </div>
        </div>

     </div>
   </div>
     <!-- Key Takeaways Section -->
     <div class="worksheet-section key-takeaways-section">
       <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
       <ul>
         <li>PWM controls motor speed and lighting by rapidly switching outputs on and off.</li>
         <li>Duty cycle is the percentage of time an output is 'on' versus 'off' in each cycle.</li>
         <li>PWM is more efficient than voltage control for variable speed applications.</li>
         <li>The Matrix PLC LOGO! Module can generate PWM signals on multiple outputs simultaneously.</li>
         <li>PWM is widely used in industry for motor drives, LED dimming, and heating control.</li>
         <li>Variable frequency drives (VFDs) often use PWM input signals for precise motor control.</li>
         <li>Understanding PWM is essential for troubleshooting variable speed systems in automation.</li>
         <li>FETs (Field Effect Transistors) act as current amplifiers for motor control applications.</li>
         <li>Transistors switch much faster than relays and are ideal for PWM applications.</li>
         <li>External transistor drivers are needed when controllers must switch larger currents quickly.</li>
         <li>Understanding your controller's internal circuitry is crucial for proper motor control implementation.</li>
       </ul>
     </div>

     <!-- Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What does PWM stand for and what does it control?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) Pulse Width Modulation - controls motor speed and lighting by varying duty cycle</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) Power Wire Management - controls electrical connections</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) Process Water Monitoring - measures temperature</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) Pressure Warning Module - controls system power</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) Pulse Width Modulation - controls motor speed and lighting by varying duty cycle.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: What does this worksheetâ€™s HMI screen represent?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) The output runs at half voltage</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) The motor runs at half speed</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) The output is 'on' 50% of the time and 'off' 50% of the time</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) The system is only half functional</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) The output is 'on' 50% of the time and 'off' 50% of the time.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: Why is PWM more efficient than varying voltage directly?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) PWM reduces energy waste by using rapid switching instead of continuous voltage regulation</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) PWM makes the motor run faster</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) PWM uses more electricity</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) PWM is not more efficient</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) PWM reduces energy waste by using rapid switching instead of continuous voltage regulation.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: What applications commonly use PWM in industrial automation?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) Only lighting control</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) Only temperature sensors</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) Only emergency systems</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) Variable speed motors, LED dimming, heating elements, and servo positioning</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) Variable speed motors, LED dimming, heating elements, and servo positioning.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: How does PWM relate to Variable Frequency Drives (VFDs)?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) PWM signals are often used as control inputs to VFDs for precise motor speed control</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) VFDs cannot use PWM signals</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) PWM replaces VFDs completely</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) VFDs only work with analog signals</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) PWM signals are often used as control inputs to VFDs for precise motor speed control.
          </div>
        </div>
        
        <div class="question-item" data-question="6">
          <h4>Question 6: What is the main purpose of using a FET in motor control applications?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-6" value="A" class="option-radio">
              <span class="option-text">A) To reduce the motor speed</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-6" value="B" class="option-radio">
              <span class="option-text">B) To act as a current amplifier between the PLC output and motor</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-6" value="C" class="option-radio">
              <span class="option-text">C) To increase the voltage to the motor</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-6" value="D" class="option-radio">
              <span class="option-text">D) To replace the PLC entirely</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(6)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) To act as a current amplifier between the PLC output and motor.
          </div>
        </div>
        
        <div class="question-item" data-question="7">
          <h4>Question 7: Why are transistors preferred over relays for PWM applications?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-7" value="A" class="option-radio">
              <span class="option-text">A) Transistors are cheaper than relays</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-7" value="B" class="option-radio">
              <span class="option-text">B) Transistors switch much faster than relays and can handle rapid PWM switching</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-7" value="C" class="option-radio">
              <span class="option-text">C) Transistors use less power</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-7" value="D" class="option-radio">
              <span class="option-text">D) Transistors are easier to install</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(7)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) Transistors switch much faster than relays and can handle rapid PWM switching.
          </div>
        </div>
        
        <div class="question-item" data-question="8">
          <h4>Question 8: What is the key difference between controlling an LED vs. a motor with PWM?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-8" value="A" class="option-radio">
              <span class="option-text">A) LEDs require more current than motors</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-8" value="B" class="option-radio">
              <span class="option-text">B) Motors typically require current amplification through transistors, while LEDs can be driven directly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-8" value="C" class="option-radio">
              <span class="option-text">C) Motors only work with analog signals</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-8" value="D" class="option-radio">
              <span class="option-text">D) There is no difference - they work exactly the same</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(8)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) Motors typically require current amplification through transistors, while LEDs can be driven directly.
          </div>
        </div>
      </div>
    </div>

  </div> <!-- Close worksheet-box -->

  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-2.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
      <div class="worksheet-header-center">
        <h1 class="worksheet-title">Worksheet 3 - Pulse Width Modulation</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-4.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetterMatch = correctAnswerText.match(/^([A-D])\)/);
  const correctLetter = correctLetterMatch ? correctLetterMatch[1] : null;
  const isCorrect = !!correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Add flag to prevent double execution
  let isProcessing = false;
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
          // Apply the completed styles
          card.style.background = '#2a2a2a';
          card.style.opacity = '0.7';
          card.style.cursor = 'default';
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        card.style.position = 'relative';
        card.style.zIndex = '1';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Prevent double execution
          if (isProcessing) {
            console.log('Already processing, ignoring click');
            return;
          }
          
          // Don't toggle if clicking directly on the checkbox or its label
          if (e.target === checkbox || 
              e.target.closest('.step-checkbox') || 
              e.target.closest('label') ||
              e.target.tagName === 'INPUT' ||
              e.target.tagName === 'LABEL') {
            console.log('Clicking on checkbox or label, not toggling card');
            return;
          }
          
          // Prevent the default checkbox behavior and stop propagation
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          // Set processing flag
          isProcessing = true;
          
          // Toggle the checkbox directly without triggering events
          checkbox.checked = !checkbox.checked;
          
          // Manually call the change handler
          handleCheckboxChange(checkbox, card, stepNumber);
          
          console.log('Checkbox toggled to:', checkbox.checked);
          console.log('Card classes after toggle:', card.className);
          
          // Reset processing flag after a short delay
          setTimeout(() => {
            isProcessing = false;
          }, 100);
        });
        
        // Create a shared change handler function
        function handleCheckboxChange(checkbox, card, stepNumber) {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            // Force the styles to apply
            card.style.background = '#2a2a2a';
            card.style.opacity = '0.7';
            card.style.cursor = 'default';
            console.log('Added step-completed class to card', stepNumber);
            console.log('Card classes after adding:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            // Reset the styles
            card.style.background = '';
            card.style.opacity = '';
            card.style.cursor = 'pointer';
            console.log('Removed step-completed class from card', stepNumber);
            console.log('Card classes after removing:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        }
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          if (!isProcessing) {
            handleCheckboxChange(checkbox, card, stepNumber);
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
          e.stopImmediatePropagation(); // Stop any other handlers
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 