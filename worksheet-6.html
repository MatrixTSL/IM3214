<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Normally Open vs Normally Closed</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>

</head>
<body>
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-5.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 6 - Normally Open vs Normally Closed</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-7.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Push buttons or control contacts can be normally open (NO) or normally closed (NC). A NO contact only sends a signal when pressed, while an NC contact is active until it is pressed. This difference helps ensure safe and reliable control in industrial automation systems.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/pump.png" alt="Pump System Maintenance">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to explore NO vs NC inputs:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Open Worksheet 6</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Navigate to Worksheet 6 on the HMI. Green text means input is on; white is off.</p>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I0 (NO)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press and hold the green button (I0). Observe I0 turning on only while pressed.</p>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I1 (NO)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press and hold the black button (I1). Observe I1 turns on only while held.</p>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I2 (NC)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Observe I2 is on by default because it is NC. Press it and confirm it turns off while pressed.</p>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I3 (NO, Latching)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press I3 once to latch it on. Press again to turn it off.</p>
            </div>
          </div>

          <div class="step-card" data-step="6">
            <div class="step-number">6</div>
            <div class="step-content">
              <div class="step-header">
                <h4>I4/I5 (3-position switch)</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Move the selector left: I4 on, I5 off. Middle: both off. Right: I4 off, I5 on.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Why this matters</h3>
          </div>
          <div class="card-content">
            <p>Understanding the difference between NO and NC is critical in maintenance. On I/O or mimic screens, you need to know whether an input should be on or off when the button is not pressed. For NO contacts, the input shows off until pressed; for NC, the input is on until pressed. If you don’t know this, you might think there’s a wiring fault when there isn’t.</p>
          </div>
        </div>
      </div>

    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>Normally Open (NO): off until pressed.</li>
        <li>Normally Closed (NC): on until pressed.</li>
        <li>Knowing expected I/O states helps spot faults quickly.</li>
        <li>Misreading NO/NC can lead to unnecessary troubleshooting.</li>
      </ul>
    </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What is the function of a pump in an industrial system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) To move fluids through a system by creating flow and pressure, supporting process control and system regulation</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) To measure the flow rate of the fluid</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) To control the temperature of the fluid</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) To filter contaminants from the fluid</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To move fluids through a system by creating flow and pressure, supporting process control and system regulation.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: How can a pump be controlled to vary its speed?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) By varying the voltage (0–24V), using PWM signals, or through a Variable Frequency Drive (VFD) to adjust speed proportionally</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) By changing the fluid temperature</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) By adjusting the valve position</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) By changing the fluid type</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) By adjusting the valve position.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: What might it indicate if a pump is running at full speed but still not meeting the setpoint?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) It could signal a system fault such as a partially closed valve, clogged filter, or restriction in the piping</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) It means the pump is working perfectly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) It means the setpoint is too low</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) It means the fluid is too hot</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) It means the pump is working perfectly.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: Why must pumps not be run dry, and what protects against this?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) Pumps use the fluid as coolant and lubricant; running dry can cause overheating or damage. A low-level sensor in the tank prevents this</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) Running dry saves energy</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) Running dry makes the pump quieter</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) Running dry increases pump efficiency</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) Pumps use the fluid as coolant and lubricant; running dry can cause overheating or damage. A low-level sensor in the tank prevents this.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: What are some signs that maintenance engineers should look for to detect pump issues early?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) Gradual drops in flow with rising power use, unusual noises, or excessive vibration are signs of potential pump problems</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) Increased flow rate is always a sign of problems</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) Lower power consumption indicates problems</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) Higher temperature always indicates problems</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) Higher temperature always indicates problems.
          </div>
        </div>
      </div>
    </div>

    <!-- Simulation Section -->
    <div class="simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> 3. Interactive Pump System Maintenance</h2>
      
      <!-- Pump Types Comparison -->
      <div class="simulation-subsection">
        <h3><i class="fas fa-pump"></i> Understanding Pump Types</h3>
        <div class="pump-types-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
          <!-- Centrifugal Pump -->
          <div class="pump-type-card" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #2196F3; margin-top: 0;">Centrifugal Pump</h4>
            <div style="margin: 15px 0;">
              <canvas id="centrifugal-chart" height="200"></canvas>
            </div>
            <ul style="color: #aaa; margin: 15px 0;">
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Uses rotating impeller to create flow</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Flow varies with pressure</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Better for high flow, lower pressure</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Common in HVAC and water systems</li>
            </ul>
            <div class="pump-controls" style="margin-top: 20px;">
              <button id="start-centrifugal" class="control-btn" style="background: #2196F3; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Start Pump</button>
              <button id="stop-centrifugal" class="control-btn" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Stop</button>
            </div>
          </div>

          <!-- Positive Displacement Pump -->
          <div class="pump-type-card" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #4CAF50; margin-top: 0;">Positive Displacement Pump</h4>
            <div style="margin: 15px 0;">
              <canvas id="pd-chart" height="200"></canvas>
            </div>
            <ul style="color: #aaa; margin: 15px 0;">
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Fixed volume per rotation</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Constant flow regardless of pressure</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Better for high pressure, lower flow</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Common in hydraulic systems</li>
            </ul>
            <div class="pump-controls" style="margin-top: 20px;">
              <button id="start-pd" class="control-btn" style="background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Start Pump</button>
              <button id="stop-pd" class="control-btn" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Stop</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Common Pump Issues -->
      <div class="simulation-subsection" style="margin-top: 40px;">
        <h3><i class="fas fa-exclamation-triangle"></i> Common Pump Issues</h3>
        <div class="pump-issues-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0;">
          
          <!-- Leak Simulation -->
          <div class="issue-card" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #FF5722; margin-top: 0;">System Leak</h4>
            <p style="color: #aaa;">Watch how flow rate drops while power consumption remains high</p>
            <div style="margin: 15px 0;">
              <canvas id="leak-chart" height="200"></canvas>
            </div>
            <ul style="color: #aaa; margin: 15px 0; padding-left: 20px;">
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Sudden drop in flow rate</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Power consumption stays high</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Pressure fluctuations</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Possible fluid loss</li>
            </ul>
            <div class="issue-controls" style="margin-top: 20px;">
              <button id="start-leak" class="control-btn" style="background: #FF5722; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Simulate Leak</button>
              <button id="reset-leak" class="control-btn" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Reset</button>
            </div>
          </div>

          <!-- Cavitation Simulation -->
          <div class="issue-card" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #9C27B0; margin-top: 0;">Cavitation</h4>
            <p style="color: #aaa;">Notice pressure fluctuations and increased vibration</p>
            <div style="margin: 15px 0;">
              <canvas id="cavitation-chart" height="200"></canvas>
            </div>
            <ul style="color: #aaa; margin: 15px 0; padding-left: 20px;">
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Erratic pressure readings</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Increased vibration levels</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Noise and potential damage</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Reduced pump efficiency</li>
            </ul>
            <div class="issue-controls" style="margin-top: 20px;">
              <button id="start-cavitation" class="control-btn" style="background: #9C27B0; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Simulate Cavitation</button>
              <button id="reset-cavitation" class="control-btn" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Reset</button>
            </div>
          </div>

          <!-- Overheating Simulation -->
          <div class="issue-card" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #F44336; margin-top: 0;">Overheating</h4>
            <p style="color: #aaa;">Observe temperature rise and efficiency loss</p>
            <div style="margin: 15px 0;">
              <canvas id="overheat-chart" height="200"></canvas>
            </div>
            <ul style="color: #aaa; margin: 15px 0; padding-left: 20px;">
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Rising temperature trend</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Decreasing efficiency</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Potential seal damage</li>
              </strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-lightbulb"></i>
              </div>
              <div class="key-point-content">
                <strong>Risk of pump failure</li>
            </ul>
            <div class="issue-controls" style="margin-top: 20px;">
              <button id="start-overheat" class="control-btn" style="background: #F44336; color: white; border: none; padding: 10px 20px; border-radius: 5px; margin-right: 10px;">Simulate Overheat</button>
              <button id="reset-overheat" class="control-btn" style="background: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px;">Reset</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- Load Chart.js first -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Then load our simulation code -->
  <script src="pump-simulation.js"></script>
  
  <script>
    // Initialize everything when the DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded - Initializing pump simulation...');
      // Initialize the simulation immediately
      if (typeof initializePumpSimulation === 'function') {
        console.log('Starting pump simulation initialization');
        initializePumpSimulation();
      } else {
        console.error('Pump simulation initialization function not found!');
      }
      loadSavedAnswers();
    });
    
        function submitAnswer(questionNumber) {
          const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
          if (!answerInput) return;
          
          const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
          if (!selectedOption) {
            alert('Please select an answer before submitting.');
            return;
          }
          
          const answer = selectedOption.value;
          
          // Save with enhanced tracking
          worksheetTracker.saveAnswer(6, questionNumber, answer, 'maintenance');
          
          // Define correct answers for worksheet 6
          const correctAnswers = {
            1: 'A',
            2: 'C',
            3: 'B',
            4: 'A',
            5: 'D'
          };
          
          // Apply visual feedback
          const allOptions = answerInput.querySelectorAll('.option-label');
          const correctAnswer = correctAnswers[questionNumber];
          
          allOptions.forEach(option => {
            const radio = option.querySelector('.option-radio');
            const optionValue = radio.value;
            
            if (optionValue === correctAnswer) {
              option.classList.add('correct');
            } else if (optionValue === answer && answer !== correctAnswer) {
              option.classList.add('incorrect');
            }
          });
          
          // Mark question as submitted to disable further interaction
          answerInput.classList.add('submitted');
          
          // Show feedback on button
          const submitBtn = answerInput.querySelector('.submit-question-btn');
          if (submitBtn) {
            const originalText = submitBtn.textContent;
            submitBtn.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
            submitBtn.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
            
            // Add incorrect class for enhanced styling
            if (answer !== correctAnswer) {
              submitBtn.classList.add('incorrect');
            }
            
            setTimeout(() => {
              submitBtn.textContent = originalText;
              submitBtn.style.background = '#4CAF50';
              submitBtn.classList.remove('incorrect');
            }, 2000);
          }
          
          // Show correct answer if available
          const correctAnswerDiv = answerInput.querySelector('.correct-answer');
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
        
        function loadSavedAnswers() {
          // This function is now handled by the tracking system
        }
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-5.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
       <div class="worksheet-header-center">
       <h1 class="worksheet-title">Worksheet 6 - Normally Open vs Normally Closed</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-7.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetter = correctAnswerText.match(/^[A-D]/);
  const isCorrect = correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Don't toggle if clicking directly on the checkbox
          if (e.target === checkbox || e.target.closest('.step-checkbox')) {
            return;
          }
          
          // Toggle the checkbox
          checkbox.checked = !checkbox.checked;
          
          // Trigger change event
          const changeEvent = new Event('change', { bubbles: true });
          checkbox.dispatchEvent(changeEvent);
          
          console.log('Checkbox toggled to:', checkbox.checked);
        });
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 