<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Valve System Maintenance</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='CP2388-worksheets.html'" class="nav-link active">
            <i class="fas fa-cogs"></i> CP2388
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-6.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 7 - Valve System Maintenance</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-8.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>This worksheet covers maintenance procedures for valve system maintenance. Control valves are precision instruments that regulate fluid flow in process control systems.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/valve.png" alt="Valve System Maintenance">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Examine the valve system and understand proportional control principles:</strong></p>
        
        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Locate and Identify Valve</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Locate the control valve in your training system. Note the electronic connector and understand that this valve controls flow by adjusting its opening position.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Proportional Control</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Run the system and change the setpoint from high to low flow rates. Observe how the valve position changes gradually rather than simply opening/closing completely. Note the connector warmth during operation.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Test Emergency Behavior</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press the E-Stop and observe whether the valve goes fully open or fully closed. Understanding this fail-safe behavior is critical for safety system design.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <!-- Valve Overview Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-valve"></i>
            <h3>Valve Control System Overview</h3>
          </div>
          <div class="card-content">
            <p>Valves play a critical role in fluid control, and their correct operation is essential for system stability and efficiency. Different types of valves serve different functions, and understanding their behaviour helps in diagnosing potential faults.</p>
          </div>
        </div>

        <!-- Flow and Pressure Regulation Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-water"></i>
            <h3>Flow and Pressure Regulation</h3>
          </div>
          <div class="card-content">
            <p>A valve controls how much fluid passes through a system.</p>
          </div>
        </div>

        <!-- Solenoid Valve Functionality Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-bolt"></i>
            <h3>Solenoid Valve Functionality</h3>
          </div>
          <div class="card-content">
            <p>Electrically operated valves should open and close reliably when activated. If a solenoid valve fails to switch, it could be due to coil failure, power loss, or blocked ports.</p>
          </div>
        </div>

        <!-- Mechanical Valves Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Mechanical Valves</h3>
          </div>
          <div class="card-content">
            <p>Not all valves are electronically operated. Some are operated mechanically like our hand valve. Some are operated using air or even other fluids, like with pilot-operated valves. There are many types of valves.</p>
          </div>
        </div>

        <!-- Proportional Valve Issues Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-sliders-h"></i>
            <h3>Proportional Valve Issues</h3>
          </div>
          <div class="card-content">
            <p>Some systems use proportional valves that adjust gradually instead of fully opening or closing. If these fail, flow control becomes erratic, leading to unstable system performance.</p>
          </div>
        </div>

        <!-- Mechanical Blockages Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Mechanical Blockages</h3>
          </div>
          <div class="card-content">
            <p>Dirt, debris, or scale buildup inside a valve can restrict movement or cause leaks, leading to pressure drops or stuck positions.</p>
          </div>
        </div>

        <!-- Valve Position Feedback Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-eye"></i>
            <h3>Valve Position Feedback</h3>
          </div>
          <div class="card-content">
            <p>Some automated systems use sensors to confirm if a valve is open, closed, or in transition. If a valve position sensor disagrees with expected operation, it may indicate a mechanical fault or electrical issue.</p>
          </div>
        </div>

        <!-- Fail-Safe Behaviour Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-shield-alt"></i>
            <h3>Fail-Safe Behaviour</h3>
          </div>
          <div class="card-content">
            <p>Certain valves return to a default position (open or closed) when power is lost. Observing how a valve reacts to power cuts or E-Stop activation can help determine if it is configured correctly for safety.</p>
          </div>
        </div>

        <!-- Key Learning Points Card -->
        <div class="key-points-card">
          <div class="card-header">
            <i class="fas fa-lightbulb"></i>
            <h3>Key Learning Points</h3>
          </div>
          <div class="key-points-grid">
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-water"></i>
              </div>
              <div class="key-point-content">
                <strong>Valves control flow, pressure, and direction in a system.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-sliders-h"></i>
              </div>
              <div class="key-point-content">
                <strong>Proportional valves adjust gradually, controlled by PWM signals.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-minus-circle"></i>
              </div>
              <div class="key-point-content">
                <strong>Valves often stay closed until 10% demand (deadband).</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <div class="key-point-content">
                <strong>Blockages, coil failures, or power loss can cause valve faults.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-cogs"></i>
              </div>
              <div class="key-point-content">
                <strong>Some valves are mechanical or pilot operated.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-eye"></i>
              </div>
              <div class="key-point-content">
                <strong>Some valves have sensors that give position feedback to detect issues.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-thermometer-half"></i>
              </div>
              <div class="key-point-content">
                <strong>Valves may get warm when operating – normal but not for leak checks.</strong>
              </div>
            </div>
            
            <div class="key-point-item">
              <div class="key-point-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div class="key-point-content">
                <strong>Always check how valves behave during an E-Stop for safety.</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What is the main function of a valve in an industrial system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) To control the flow of fluids by opening, closing, or partially restricting the passage through the system</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) To measure the pressure of the fluid</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) To generate power for the system</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) To filter the fluid</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To control the flow of fluids by opening, closing, or partially restricting the passage through the system.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: How is the valve position controlled in this system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) By using Pulse Width Modulation (PWM) to vary voltage, which proportionally adjusts how open or closed the valve is</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) By manually turning a handle</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) By changing the fluid temperature</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) By adjusting the pump speed</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) By adjusting the pump speed.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: What is meant by the term "deadband" in valve control?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) Deadband refers to the range (typically 0–10% demand) where the valve remains shut and doesn't begin opening until demand exceeds this threshold</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) Deadband is the maximum opening of the valve</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) Deadband is the minimum flow rate</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) Deadband is the valve's response time</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) Deadband is the maximum opening of the valve.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: What should you do to check if a valve is active during operation?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) Carefully feel for warmth on the valve's electrical connector, it typically gets warm when active (never check for leaks by hand)</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) Touch the valve body directly</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) Listen for noise from the valve</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) Check the valve's color</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) Listen for noise from the valve.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: Why is it important to observe valve behaviour during an Emergency Stop?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) To ensure the valve fails to the correct position (open or closed) for safety, in this system, it should go fully closed</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) To see if the valve makes noise</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) To check if the valve changes color</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) To measure the valve's temperature</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) To see if the valve makes noise.
          </div>
        </div>
      </div>
    </div>

    <!-- Simulation Section -->
    <div class="simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> 3. Interactive Valve System Maintenance</h2>
      <div id="valve-panel" class="simulation-container">
        <div class="simulation-loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading valve simulation...</p>
          <p>Simulation will initialize automatically</p>
        </div>
      </div>
      
      <!-- On/Off Valve Simulation -->
      <div class="simulation-subsection">
        <h3><i class="fas fa-toggle-on"></i> On/Off Valve Control</h3>
        <div class="valve-simulation-container" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin: 20px 0;">
          <!-- Valve Control Panel -->
          <div class="valve-control-panel" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #2196F3; margin-top: 0;">Valve Controls</h4>
            <div style="margin: 20px 0;">
              <button id="start-onoff-pump" class="control-btn" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 10px;">Start Pump</button>
              <button id="stop-onoff-pump" class="control-btn" style="background: #FF5722; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 20px;">Stop Pump</button>
              <button id="toggle-valve" class="control-btn" style="background: #2196F3; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px;">Open Valve</button>
            </div>
            <div class="valve-status" style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
              <p style="margin: 0; color: #aaa;">Pump: <span id="pump-state" style="color: #FF5722;">Stopped</span></p>
              <p style="margin: 10px 0; color: #aaa;">Valve: <span id="valve-state" style="color: #FF5722;">Closed</span></p>
              <p style="margin: 0; color: #aaa;">Flow Rate: <span id="flow-rate" style="color: #4CAF50;">0 L/min</span></p>
            </div>
          </div>
          <!-- Flow Rate Chart -->
          <div style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <canvas id="onoff-valve-chart" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Proportional Valve Simulation -->
      <div class="simulation-subsection" style="margin-top: 40px;">
        <h3><i class="fas fa-sliders"></i> Proportional Valve Control</h3>
        <div class="valve-simulation-container" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin: 20px 0;">
          <!-- Valve Control Panel -->
          <div class="valve-control-panel" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #4CAF50; margin-top: 0;">Valve Position Control</h4>
            <div style="margin: 20px 0;">
              <button id="start-prop-pump" class="control-btn" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 10px;">Start Pump</button>
              <button id="stop-prop-pump" class="control-btn" style="background: #FF5722; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 20px;">Stop Pump</button>
              <label style="color: #aaa; display: block; margin-bottom: 10px;">Valve Opening (%)</label>
              <input type="range" id="valve-position" min="0" max="100" value="0" 
                     style="width: 100%; height: 10px; border-radius: 5px; -webkit-appearance: none; background: linear-gradient(to right, #4CAF50 0%, #4CAF50 0%, #333 0%, #333 100%); cursor: pointer;">
              <style>
                #valve-position::-webkit-slider-thumb {
                  -webkit-appearance: none;
                  appearance: none;
                  width: 20px;
                  height: 20px;
                  border-radius: 50%;
                  background: #4CAF50;
                  border: 2px solid #fff;
                  cursor: pointer;
                  box-shadow: 0 0 5px rgba(0,0,0,0.3);
                }
                #valve-position::-moz-range-thumb {
                  width: 20px;
                  height: 20px;
                  border-radius: 50%;
                  background: #4CAF50;
                  border: 2px solid #fff;
                  cursor: pointer;
                  box-shadow: 0 0 5px rgba(0,0,0,0.3);
                }
                #valve-position:focus {
                  outline: none;
                }
              </style>
              <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                <span style="color: #666;">0%</span>
                <span id="position-value" style="color: #4CAF50;">0%</span>
                <span style="color: #666;">100%</span>
              </div>
            </div>
            <div class="valve-status" style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
              <p style="margin: 0; color: #aaa;">Pump: <span id="prop-pump-state" style="color: #FF5722;">Stopped</span></p>
              <p style="margin: 10px 0; color: #aaa;">Position: <span id="prop-valve-state" style="color: #4CAF50;">0%</span></p>
              <p style="margin: 0; color: #aaa;">Flow Rate: <span id="prop-flow-rate" style="color: #4CAF50;">0 L/min</span></p>
            </div>
          </div>
          <!-- Flow Rate Chart -->
          <div style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <canvas id="prop-valve-chart" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Valve Sequencing Simulation -->
      <div class="simulation-subsection" style="margin-top: 40px;">
        <h3><i class="fas fa-list-ol"></i> Valve Sequencing</h3>
        <div class="sequence-simulation-container" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin: 20px 0;">
          <!-- Sequence Control Panel -->
          <div class="sequence-control-panel" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <h4 style="color: #9C27B0; margin-top: 0;">Cylinder Control Sequence</h4>
            <div style="margin: 20px 0;">
              <button id="start-sequence" class="control-btn" style="background: #9C27B0; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 10px;">Start Sequence</button>
              <button id="reset-sequence" class="control-btn" style="background: #666; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px;">Reset</button>
            </div>
            <div class="sequence-status" style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
              <p style="margin: 0; color: #aaa;">Current Step: <span id="sequence-step" style="color: #9C27B0;">Ready</span></p>
              <p style="margin: 10px 0 0 0; color: #aaa;">Cylinder Position: <span id="cylinder-position" style="color: #9C27B0;">0%</span></p>
            </div>
            <!-- Valve States -->
            <div style="margin-top: 20px;">
              <h5 style="color: #aaa; margin: 0 0 10px 0;">Valve States:</h5>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                <div class="valve-indicator" style="padding: 10px; background: #1a1a1a; border-radius: 5px; text-align: center;">
                  <span style="color: #aaa;">V1: </span>
                  <span id="v1-state" style="color: #FF5722;">Closed</span>
                </div>
                <div class="valve-indicator" style="padding: 10px; background: #1a1a1a; border-radius: 5px; text-align: center;">
                  <span style="color: #aaa;">V2: </span>
                  <span id="v2-state" style="color: #FF5722;">Closed</span>
                </div>
                <div class="valve-indicator" style="padding: 10px; background: #1a1a1a; border-radius: 5px; text-align: center;">
                  <span style="color: #aaa;">V3: </span>
                  <span id="v3-state" style="color: #FF5722;">Closed</span>
                </div>
                <div class="valve-indicator" style="padding: 10px; background: #1a1a1a; border-radius: 5px; text-align: center;">
                  <span style="color: #aaa;">V4: </span>
                  <span id="v4-state" style="color: #FF5722;">Closed</span>
                </div>
              </div>
            </div>
          </div>
          <!-- Cylinder Position Chart -->
          <div style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <canvas id="sequence-chart" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="valve-simulation.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const initFunc = 'initializeValveSimulation';
      setTimeout(() => {
        if (typeof window[initFunc] === 'function') {
          console.log('Initializing', initFunc);
          window[initFunc]();
        } else {
          document.querySelector('.simulation-loading').innerHTML = '<p>Simulation ready - Valve System Maintenance</p>';
        }
      }, 1000);
      loadSavedAnswers();
    });
    
        function submitAnswer(questionNumber) {
          const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
          if (!answerInput) return;
          
          const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
          if (!selectedOption) {
            alert('Please select an answer before submitting.');
            return;
          }
          
          const answer = selectedOption.value;
          
          // Save with enhanced tracking
          worksheetTracker.saveAnswer(7, questionNumber, answer, 'maintenance');
          
          // Define correct answers for worksheet 7
          const correctAnswers = {
                "1": "A",
                "2": "D",
                "3": "B",
                "4": "C",
                "5": "B"
          };
          
          // Apply visual feedback
          const allOptions = answerInput.querySelectorAll('.option-label');
          const correctAnswer = correctAnswers[questionNumber];
          
          allOptions.forEach(option => {
            const radio = option.querySelector('.option-radio');
            const optionValue = radio.value;
            
            if (optionValue === correctAnswer) {
              option.classList.add('correct');
            } else if (optionValue === answer && answer !== correctAnswer) {
              option.classList.add('incorrect');
            }
          });
          
          // Mark question as submitted to disable further interaction
          answerInput.classList.add('submitted');
          
          // Show feedback on button
          const submitBtn = answerInput.querySelector('.submit-question-btn');
          if (submitBtn) {
            const originalText = submitBtn.textContent;
            submitBtn.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
            submitBtn.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
            
            // Add incorrect class for enhanced styling
            if (answer !== correctAnswer) {
              submitBtn.classList.add('incorrect');
            }
            
            setTimeout(() => {
              submitBtn.textContent = originalText;
              submitBtn.style.background = '#4CAF50';
              submitBtn.classList.remove('incorrect');
            }, 2000);
          }
          
          // Show correct answer if available
          const correctAnswerDiv = answerInput.querySelector('.correct-answer');
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
    function loadSavedAnswers() {
      // This function is now handled by the tracking system
    }
    
    // Step card click functionality
    function initializeStepCardClicks() {
      const stepCards = document.querySelectorAll('.step-card');
      
      stepCards.forEach(card => {
        card.addEventListener('click', function(e) {
          // Don't trigger if clicking on the checkbox itself
          if (e.target.closest('.step-checkbox')) {
            return;
          }
          
          const checkbox = this.querySelector('.step-complete-checkbox');
          if (checkbox) {
            // Toggle the checkbox
            checkbox.checked = !checkbox.checked;
            
            // Update the card's completed state using the existing class name
            if (checkbox.checked) {
              this.classList.add('step-completed');
            } else {
              this.classList.remove('step-completed');
            }
            
            // Trigger change event on checkbox for any existing listeners
            const event = new Event('change', { bubbles: true });
            checkbox.dispatchEvent(event);
          }
        });
      });
    }
    
    // Initialize step card functionality when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      initializeStepCardClicks();
      
      // Use the existing step tracking system
      if (typeof initializeStepTracking === 'function') {
        initializeStepTracking();
      }
    });
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-6.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
      <div class="worksheet-header-center">
        <h1 class="worksheet-title">Worksheet 7 - Valve System Maintenance</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-8.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
</body>
</html> 