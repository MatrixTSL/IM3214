<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Potentiometer</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>

</head>
<body>


  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-7.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 8 - Potentiometer</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-9.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>A potentiometer is an adjustable resistor used to create a variable voltage signal, typically between 0 and 10 V. In PLC systems, it is commonly used to set speeds, adjust levels, or simulate sensor values. Understanding how potentiometers work helps engineers control analogue inputs, scale values, and test system responses accurately.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/float-switch.png" alt="Float Switch System Maintenance">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Follow these steps to explore the potentiometer and scaling:</strong></p>

        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Open Worksheet 8</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Turn the potentiometer to 0 and observe the motor speed.</p>
            </div>
          </div>

          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Go To 100%</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Slowly rotate the potentiometer to the right until the HMI shows 100%.</p>
            </div>
          </div>

          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Add Offset +50</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press the purple “i” next to Potentiometer Scaled and apply an offset of 50. Rotate to observe the effect.</p>
            </div>
          </div>

          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Add Offset -50</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Set the offset to -50 and repeat the test.</p>
            </div>
          </div>

          <div class="step-card" data-step="5">
            <div class="step-number">5</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Change Scalar</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Remove the offset. Change scalar from 100 to 10 and observe behaviour. Adjust until the scaled value represents a sensible ambient temperature (20–40°C).</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Why this matters</h3>
          </div>
          <div class="card-content">
            <p>Potentiometers are used to give operators direct control over speed, pressure, temperature or position. Offsets and scaling change how inputs behave—if you don’t understand them, you can misdiagnose faults. Real systems rarely use the full 0–10 V range, so correct scaling is essential.</p>
            <h3 style="margin-top:16px;">Key Takeaways</h3>
            <ul>
              <li>Potentiometer is a 0–10 V analogue input to the PLC.</li>
              <li>Offset shifts the whole range; scalar stretches or compresses it.</li>
              <li>Correct scaling is needed to match real-world units (e.g., % or RPM).</li>
              <li>Used to tune, simulate, and test system responses.</li>
            </ul>
          </div>
        </div>
      </div>

    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions & Answers</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What is the main purpose of a float switch in an industrial system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) To detect liquid levels in a tank and trigger actions such as stopping a pump or sounding an alarm</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) To measure the temperature of the liquid</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) To control the flow rate of the liquid</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) To filter impurities from the liquid</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To detect liquid levels in a tank and trigger actions such as stopping a pump or sounding an alarm.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: What is the difference between a normally open (NO) and a normally closed (NC) float switch?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) A NO switch only sends a signal when activated (float is lifted). An NC switch sends a signal when inactivated and breaks the signal when lifted</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) A NO switch is always on, an NC switch is always off</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) A NO switch measures temperature, an NC switch measures pressure</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) There is no difference between them</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) A NO switch is always on, an NC switch is always off.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: Why is the low-level float switch normally open (NO)?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) So, the pump only runs when there is enough fluid. If the level drops, the circuit opens and stops the pump to prevent dry running</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) So the pump runs continuously</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) So the pump runs faster</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) So the pump uses less energy</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) So the pump runs faster.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: Why is the high-level float switch normally closed (NC)?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) So, the system constantly monitors for overflow. If the tank gets too full, the circuit breaks and stops the filling process or triggers an alarm</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) So the tank fills continuously</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) So the tank fills faster</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) So the tank uses less energy</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> D) So the tank uses less energy.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: What are some common float switch faults, and how can they be identified?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) Sticking, misalignment, or contact failure. These can be identified by testing float movement and checking IO screen signals</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) High temperature, low pressure, or electrical noise</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) Fast flow, slow flow, or no flow</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) High voltage, low voltage, or no voltage</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) High temperature, low pressure, or electrical noise.
          </div>
        </div>
      </div>
    </div>

    <!-- Simulation Section -->
    <div class="simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> 3. Interactive Float Switch System Maintenance</h2>
      
      <!-- Basic Tank (Two-Switch Configuration) -->
      <div class="simulation-subsection" style="margin-bottom: 40px;">
        <h3><i class="fas fa-tint"></i> Basic Tank (Two-Switch Configuration)</h3>
        <div class="tank-simulation-container" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin: 20px 0;">
          <!-- Tank Control Panel -->
          <div class="tank-control-panel" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <!-- Visual Tank -->
            <div class="tank-visual" style="width: 100%; height: 200px; background: #1a1a1a; border-radius: 8px; position: relative; margin-bottom: 20px; border: 2px solid #333;">
              <!-- Tank Fill -->
              <div id="basic-tank-fill" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: linear-gradient(180deg, #2196F3 0%, #1976D2 100%); transition: height 0.3s ease;"></div>
              <!-- Switch Indicators -->
              <div style="position: absolute; right: -8px; width: 16px; height: 100%;">
                <!-- High Switch (80%) -->
                <div style="position: absolute; top: 20%; width: 100%; height: 2px; background: #FF5722;"></div>
                <div id="basic-high-indicator" style="position: absolute; top: 20%; right: 0; width: 12px; height: 12px; background: #FF5722; border-radius: 50%; transform: translateY(-50%);"></div>
                <!-- Low Switch (20%) -->
                <div style="position: absolute; top: 80%; width: 100%; height: 2px; background: #FF9800;"></div>
                <div id="basic-low-indicator" style="position: absolute; top: 80%; right: 0; width: 12px; height: 12px; background: #FF9800; border-radius: 50%; transform: translateY(-50%);"></div>
              </div>
            </div>
            
            <h4 style="color: #2196F3; margin-top: 0;">Tank Controls</h4>
            <div style="margin: 20px 0;">
              <button id="basic-fill" class="control-btn" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 10px;">Start Fill</button>
              <button id="basic-drain" class="control-btn" style="background: #FF5722; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px;">Start Drain</button>
            </div>
            <div class="tank-status" style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
              <p style="margin: 0; color: #aaa;">Level: <span id="basic-level" style="color: #2196F3;">0%</span></p>
              <p style="margin: 10px 0; color: #aaa;">High Switch: <span id="basic-high" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 10px 0; color: #aaa;">Low Switch: <span id="basic-low" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 0; color: #aaa;">Pump: <span id="basic-pump" style="color: #666;">IDLE</span></p>
            </div>
          </div>
          <!-- Tank Level Chart -->
          <div style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <canvas id="basic-tank-chart" height="200"></canvas>
          </div>
        </div>
      </div>

      <!-- Advanced Tank (Four-Switch Configuration) -->
      <div class="simulation-subsection">
        <h3><i class="fas fa-tint"></i> Advanced Tank (Four-Switch Configuration)</h3>
        <div class="tank-simulation-container" style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin: 20px 0;">
          <!-- Tank Control Panel -->
          <div class="tank-control-panel" style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <!-- Visual Tank -->
            <div class="tank-visual" style="width: 100%; height: 200px; background: #1a1a1a; border-radius: 8px; position: relative; margin-bottom: 20px; border: 2px solid #333;">
              <!-- Tank Fill -->
              <div id="adv-tank-fill" style="position: absolute; bottom: 0; left: 0; width: 100%; height: 0%; background: linear-gradient(180deg, #4CAF50 0%, #388E3C 100%); transition: height 0.3s ease;"></div>
              <!-- Switch Indicators -->
              <div style="position: absolute; right: -8px; width: 16px; height: 100%;">
                <!-- High Cutout (90%) -->
                <div style="position: absolute; top: 10%; width: 100%; height: 2px; background: #F44336;"></div>
                <div id="adv-high-cut-indicator" style="position: absolute; top: 10%; right: 0; width: 12px; height: 12px; background: #F44336; border-radius: 50%; transform: translateY(-50%);"></div>
                <!-- High Warning (70%) -->
                <div style="position: absolute; top: 30%; width: 100%; height: 2px; background: #FF9800;"></div>
                <div id="adv-high-warn-indicator" style="position: absolute; top: 30%; right: 0; width: 12px; height: 12px; background: #FF9800; border-radius: 50%; transform: translateY(-50%);"></div>
                <!-- Low Warning (30%) -->
                <div style="position: absolute; top: 70%; width: 100%; height: 2px; background: #FF9800;"></div>
                <div id="adv-low-warn-indicator" style="position: absolute; top: 70%; right: 0; width: 12px; height: 12px; background: #FF9800; border-radius: 50%; transform: translateY(-50%);"></div>
                <!-- Low Cutout (10%) -->
                <div style="position: absolute; top: 90%; width: 100%; height: 2px; background: #F44336;"></div>
                <div id="adv-low-cut-indicator" style="position: absolute; top: 90%; right: 0; width: 12px; height: 12px; background: #F44336; border-radius: 50%; transform: translateY(-50%);"></div>
              </div>
            </div>
            
            <h4 style="color: #4CAF50; margin-top: 0;">Tank Controls</h4>
            <div style="margin: 20px 0;">
              <button id="adv-fill" class="control-btn" style="background: #4CAF50; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px; margin-bottom: 10px;">Start Fill</button>
              <button id="adv-drain" class="control-btn" style="background: #FF5722; color: white; border: none; padding: 15px 30px; border-radius: 5px; width: 100%; font-size: 16px;">Start Drain</button>
            </div>
            <div class="tank-status" style="margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 5px;">
              <p style="margin: 0; color: #aaa;">Level: <span id="adv-level" style="color: #4CAF50;">0%</span></p>
              <p style="margin: 10px 0; color: #aaa;">High Cutout: <span id="adv-high-cut" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 10px 0; color: #aaa;">High Warning: <span id="adv-high-warn" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 10px 0; color: #aaa;">Low Warning: <span id="adv-low-warn" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 10px 0; color: #aaa;">Low Cutout: <span id="adv-low-cut" style="color: #FF5722;">OFF</span></p>
              <p style="margin: 0; color: #aaa;">Pump: <span id="adv-pump" style="color: #666;">IDLE</span></p>
              <div id="adv-alerts" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333;">
                <p style="margin: 0; color: #aaa;">Alerts: <span style="color: #4CAF50;">None</span></p>
              </div>
            </div>
          </div>
          <!-- Tank Level Chart -->
          <div style="background: #2a2a2a; padding: 20px; border-radius: 12px; border: 1px solid #333;">
            <canvas id="adv-tank-chart" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="float-switch-simulation.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const initFunc = 'initializeFloatSwitchSimulation';
      setTimeout(() => {
        if (typeof window[initFunc] === 'function') {
          console.log('Initializing', initFunc);
          window[initFunc]();
        } else {
          document.querySelector('.simulation-loading').innerHTML = '<p>Simulation ready - Float Switch System Maintenance</p>';
        }
      }, 1000);
      loadSavedAnswers();
    });
    
        function submitAnswer(questionNumber) {
          const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
          if (!answerInput) return;
          
          const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
          if (!selectedOption) {
            alert('Please select an answer before submitting.');
            return;
          }
          
          const answer = selectedOption.value;
          
          // Save with enhanced tracking
          worksheetTracker.saveAnswer(8, questionNumber, answer, 'maintenance');
          
          // Define correct answers for worksheet 8
          const correctAnswers = {
                "1": "A",
                "2": "B",
                "3": "C",
                "4": "D",
                "5": "B"
          };
          
          // Apply visual feedback
          const allOptions = answerInput.querySelectorAll('.option-label');
          const correctAnswer = correctAnswers[questionNumber];
          
          allOptions.forEach(option => {
            const radio = option.querySelector('.option-radio');
            const optionValue = radio.value;
            
            if (optionValue === correctAnswer) {
              option.classList.add('correct');
            } else if (optionValue === answer && answer !== correctAnswer) {
              option.classList.add('incorrect');
            }
          });
          
          // Mark question as submitted to disable further interaction
          answerInput.classList.add('submitted');
          
          // Show feedback on button
          const submitBtn = answerInput.querySelector('.submit-question-btn');
          if (submitBtn) {
            const originalText = submitBtn.textContent;
            submitBtn.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
            submitBtn.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
            
            // Add incorrect class for enhanced styling
            if (answer !== correctAnswer) {
              submitBtn.classList.add('incorrect');
            }
            
            setTimeout(() => {
              submitBtn.textContent = originalText;
              submitBtn.style.background = '#4CAF50';
              submitBtn.classList.remove('incorrect');
            }, 2000);
          }
          
          // Show correct answer if available
          const correctAnswerDiv = answerInput.querySelector('.correct-answer');
          if (correctAnswerDiv) {
            correctAnswerDiv.style.display = 'block';
          }
        }
    function loadSavedAnswers() {
      // This function is now handled by the tracking system
    }
    function loadSavedAnswers() {
      // This function is now handled by the tracking system
    }
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-7.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
       <div class="worksheet-header-center">
       <h1 class="worksheet-title">Worksheet 8 - Potentiometer</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-9.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetter = correctAnswerText.match(/^[A-D]/);
  const isCorrect = correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Don't toggle if clicking directly on the checkbox
          if (e.target === checkbox || e.target.closest('.step-checkbox')) {
            return;
          }
          
          // Toggle the checkbox
          checkbox.checked = !checkbox.checked;
          
          // Trigger change event
          const changeEvent = new Event('change', { bubbles: true });
          checkbox.dispatchEvent(changeEvent);
          
          console.log('Checkbox toggled to:', checkbox.checked);
        });
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 