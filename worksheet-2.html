<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Sequenced Outputs</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <link rel="manifest" href="manifest.json">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>
  <script defer src="shared-navigation.js"></script>
  <script defer src="pwa-install.js"></script>
  <style>
    /* Enhanced step card styling for better clickability */
    .step-card {
      transition: all 0.3s ease !important;
      cursor: pointer !important;
      position: relative !important;
      overflow: hidden !important;
      background: #333 !important;
    }
    
    .step-card:hover {
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3) !important;
      border-color: var(--accent-color) !important;
      background: #3a3a3a !important;
    }
    
    .step-card:active {
      transform: translateY(0px) !important;
      box-shadow: 0 2px 8px rgba(74, 158, 255, 0.2) !important;
    }
    
    .step-card.step-completed {
      background: #2a2a2a !important;
      opacity: 0.7 !important;
      cursor: default !important;
      border-left-color: #666 !important;
    }
    
    .step-card.step-completed:hover {
      transform: none !important;
      box-shadow: none !important;
      background: #2a2a2a !important;
    }
    
    /* Make sure the checkbox area doesn't interfere */
    .step-checkbox {
      pointer-events: auto !important;
      z-index: 10 !important;
    }
    
    .step-complete-checkbox {
      pointer-events: auto !important;
    }
  </style>
</head>
<body>


  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-1.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 2 - Sequenced Outputs</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-3.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Sequenced outputs control systems where outputs turn on and off in a specific order, like traffic lights. These systems use state machines to move from one condition to the next. In this worksheet, you'll build a traffic light system and learn how PLCs control sequenced operations in automation.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/worksheets/ws2.png" alt="Siemens S7-1200 PLC">
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Navigate to Worksheet 2 and observe how the same hardware can perform more complex tasks. This system demonstrates sequencing and latching in PLC control.</strong></p>
        
        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Assemble the Traffic Light System</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Connect three LED output modules to your Matrix PLC LOGO! Module to create a traffic light system. Arrange them vertically with Red at the top, Amber in the middle, and Green at the bottom, just like a real traffic light.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Load Program 2</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Use the LOGO! Soft Comfort software to load Program 2 into your PLC. This program contains the traffic light sequencing logic that will control your LED outputs in the proper sequence.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Start the Sequence</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press input I0 to start the traffic light sequence. Watch as the lights change in the correct traffic light pattern: Red → Red+Amber → Green → Amber → back to Red.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Analyze the State Machine</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Observe how the PLC program moves from one state to the next automatically. This is called a state machine - each state has specific outputs active, and transitions occur based on timing conditions.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <!-- Main Explanation Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-cogs"></i>
            <h3>Sequenced Output Control</h3>
          </div>
          <div class="card-content">
            <p>Sequenced outputs are fundamental to automation systems. Unlike simple on/off control, sequenced systems move through different states in a specific order. The traffic light system demonstrates how a PLC can manage multiple outputs in a timed sequence, ensuring each state occurs for the correct duration before moving to the next.</p>
          </div>
        </div>

        <!-- System Behavior Card -->
        <div class="explanation-card">
          <div class="card-header">
            <i class="fas fa-chart-line"></i>
            <h3>State Machine Operation</h3>
          </div>
          <div class="card-content">
            <p>The traffic light system is a state machine - each state (Red, Red+Amber, Green, Amber) has specific outputs active and transitions occur based on timer conditions. This pattern is used throughout industry for controlling assembly lines, robotic systems, and process equipment where operations must happen in a specific sequence.</p>
          </div>
        </div>

        <!-- Key Learning Points moved to dedicated section below -->
      </div>
    </div>

    <!-- Key Takeaways Section -->
    <div class="worksheet-section key-takeaways-section">
      <h2 class="section-header"><i class="fas fa-list-check"></i> Key Takeaways</h2>
      <ul>
        <li>Sequenced outputs control systems where outputs turn on and off in a specific order.</li>
        <li>State machines use defined states with specific outputs and controlled transitions between them.</li>
        <li>Traffic light systems demonstrate classic sequencing control with timed state transitions.</li>
        <li>Timers control how long each state remains active before transitioning to the next.</li>
        <li>Industrial automation uses sequencing for assembly lines, robotic systems, and process control.</li>
        <li>Understanding sequences is essential for troubleshooting automated systems.</li>
        <li>The Matrix PLC LOGO! Module can implement complex sequencing with simple programming.</li>
      </ul>
    </div>

    <!-- Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Questions</h2>
      <div class="questions-content">
        <div class="question-item" data-question="1">
          <h4>Question 1: What is a sequenced output system?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A">
              <span class="option-text">A) A system where outputs turn on and off in a specific order, like traffic lights</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B">
              <span class="option-text">B) Only simple on/off functions</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C">
              <span class="option-text">C) Single button operations</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D">
              <span class="option-text">D) Manual processes only</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) A system where outputs turn on and off in a specific order, like traffic lights
          </div>
        </div>

        <div class="question-item" data-question="2">
          <h4>Question 2: What happens when you press input I0 in this worksheet?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A">
              <span class="option-text">A) Nothing happens</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B">
              <span class="option-text">B) The outputs turn on one by one in a sequence, even after you release the button</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C">
              <span class="option-text">C) The system shuts down</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D">
              <span class="option-text">D) All outputs turn on at once</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> B) Red and Amber lights come on together
          </div>
        </div>

        <div class="question-item" data-question="3">
          <h4>Question 3: What is a state machine in automation?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A">
              <span class="option-text">A) A system with defined states and controlled transitions between them</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B">
              <span class="option-text">B) A machine that makes states</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C">
              <span class="option-text">C) A button that must be held down</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D">
              <span class="option-text">D) A system that resets automatically</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) A system with defined states and controlled transitions between them
          </div>
        </div>

        <div class="question-item" data-question="4">
          <h4>Question 4: What controls the timing between traffic light states?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A">
              <span class="option-text">A) Manual button presses</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B">
              <span class="option-text">B) Random timing</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C">
              <span class="option-text">C) Timers programmed in the PLC</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D">
              <span class="option-text">D) External sensors only</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> C) Timers programmed in the PLC
          </div>
        </div>

        <div class="question-item" data-question="5">
          <h4>Question 5: Why are sequenced systems important in industrial automation?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A">
              <span class="option-text">A) They ensure operations happen in the correct order for safety and efficiency</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B">
              <span class="option-text">B) They're not important</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C">
              <span class="option-text">C) Only for traffic light systems</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D">
              <span class="option-text">D) Only for simple systems</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) They ensure operations happen in the correct order for safety and efficiency
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-1.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
      <div class="worksheet-header-center">
        <h1 class="worksheet-title">Worksheet 2 - Sequenced Outputs</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-3.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

<script>

// Enhanced answer handling functions
function submitAnswer(questionNumber) {
  const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
  if (!answerInput) return;
  
  const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
  if (!selectedOption) {
    alert('Please select an answer before submitting.');
    return;
  }
  
  const answer = selectedOption.value;
  
  // Save with enhanced tracking if available
  if (typeof worksheetTracker !== 'undefined') {
    const worksheetId = getUrlParameter('id') || getWorksheetIdFromUrl();
    const path = window.location.pathname;
    const isFaultScenario = path.includes('fault-scenario');
    const type = getUrlParameter('type') || (isFaultScenario ? 'fault' : 'maintenance');
    worksheetTracker.saveAnswer(worksheetId, questionNumber, answer, type);
  } else {
    saveAnswer(questionNumber, answer);
  }
  
  // Get correct answer from the correct-answer div
  const correctAnswerDiv = answerInput.querySelector('.correct-answer');
  let correctAnswerText = '';
  if (correctAnswerDiv) {
    const strongElement = correctAnswerDiv.querySelector('strong');
    if (strongElement) {
      correctAnswerText = strongElement.nextSibling.textContent.trim();
    }
  }
  
  // Determine if answer is correct (extract letter from correct answer)
  const correctLetterMatch = correctAnswerText.match(/^([A-D])\)/);
  const correctLetter = correctLetterMatch ? correctLetterMatch[1] : null;
  const isCorrect = !!correctLetter && answer === correctLetter;
  
  // Style the selected option
  const allOptions = answerInput.querySelectorAll('.option-label');
  allOptions.forEach(option => {
    option.classList.remove('correct', 'incorrect');
  });
  
  if (isCorrect) {
    selectedOption.closest('.option-label').classList.add('correct');
  } else {
    selectedOption.closest('.option-label').classList.add('incorrect');
    // Also mark the correct option as correct
    const correctOption = answerInput.querySelector(`input[name="question-${questionNumber}"][value="${correctLetter}"]`);
    if (correctOption) {
      correctOption.closest('.option-label').classList.add('correct');
    }
  }
  
  const submitBtn = answerInput.querySelector('.submit-question-btn');
  if (submitBtn) {
    submitBtn.textContent = isCorrect ? 'Correct!' : 'Incorrect';
    submitBtn.style.background = isCorrect ? '#4CAF50' : '#f44336';
    setTimeout(() => {
      submitBtn.textContent = 'Submit Answer';
      submitBtn.style.background = '#4CAF50';
    }, 2000);
  }
  
  // Show correct answer
  if (correctAnswerDiv) {
    correctAnswerDiv.style.display = 'block';
  }
}


// Enhanced step tracking functions
function initializeStepTracking() {
  console.log('Initializing step tracking...');
  
  // Wait a bit to ensure DOM is ready
  setTimeout(() => {
    const stepCards = document.querySelectorAll('.step-card');
    console.log('Found', stepCards.length, 'step cards');
    
    stepCards.forEach((card, index) => {
      const checkbox = card.querySelector('.step-complete-checkbox');
      const stepNumber = card.getAttribute('data-step') || (index + 1);
      
      console.log('Setting up card', stepNumber, 'with checkbox:', !!checkbox);
      
      if (checkbox) {
        // Add a flag to prevent double execution
        let isProcessing = false;
        // Load saved state
        const savedState = localStorage.getItem(`step-${stepNumber}`);
        if (savedState === 'true') {
          checkbox.checked = true;
          card.classList.add('step-completed');
          // Apply the completed styles
          card.style.background = '#2a2a2a';
          card.style.opacity = '0.7';
          card.style.cursor = 'default';
        }
        
        // Make the entire card clickable
        card.style.cursor = 'pointer';
        card.style.position = 'relative';
        card.style.zIndex = '1';
        
        // Add click handler to the entire card
        card.addEventListener('click', function(e) {
          console.log('Card clicked:', stepNumber);
          
          // Prevent double execution
          if (isProcessing) {
            console.log('Already processing, ignoring click');
            return;
          }
          
          // Don't toggle if clicking directly on the checkbox or its label
          if (e.target === checkbox || 
              e.target.closest('.step-checkbox') || 
              e.target.closest('label') ||
              e.target.tagName === 'INPUT' ||
              e.target.tagName === 'LABEL') {
            console.log('Clicking on checkbox or label, not toggling card');
            return;
          }
          
          // Prevent the default checkbox behavior and stop propagation
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          // Set processing flag
          isProcessing = true;
          
          // Toggle the checkbox directly without triggering events
          checkbox.checked = !checkbox.checked;
          
          // Manually call the change handler
          handleCheckboxChange(checkbox, card, stepNumber);
          
          console.log('Checkbox toggled to:', checkbox.checked);
          console.log('Card classes after toggle:', card.className);
          
          // Reset processing flag after a short delay
          setTimeout(() => {
            isProcessing = false;
          }, 100);
        });
        
        // Create a shared change handler function
        function handleCheckboxChange(checkbox, card, stepNumber) {
          console.log('Checkbox changed:', stepNumber, 'checked:', checkbox.checked);
          
          if (checkbox.checked) {
            card.classList.add('step-completed');
            // Force the styles to apply
            card.style.background = '#2a2a2a';
            card.style.opacity = '0.7';
            card.style.cursor = 'default';
            console.log('Added step-completed class to card', stepNumber);
            console.log('Card classes after adding:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'true');
          } else {
            card.classList.remove('step-completed');
            // Reset the styles
            card.style.background = '';
            card.style.opacity = '';
            card.style.cursor = 'pointer';
            console.log('Removed step-completed class from card', stepNumber);
            console.log('Card classes after removing:', card.className);
            localStorage.setItem(`step-${stepNumber}`, 'false');
          }
        }
        
        // Add change handler to checkbox
        checkbox.addEventListener('change', function() {
          if (!isProcessing) {
            handleCheckboxChange(checkbox, card, stepNumber);
          }
        });
        
        // Also make the checkbox itself clickable
        checkbox.addEventListener('click', function(e) {
          e.stopPropagation(); // Prevent card click when clicking checkbox
          e.stopImmediatePropagation(); // Stop any other handlers
        });
      }
    });
  }, 100);
}

// Initialize when page loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initializeStepTracking);
} else {
  // DOM is already loaded
  initializeStepTracking();
}

// Also try again after a short delay to ensure everything is ready
setTimeout(initializeStepTracking, 500);


</script>
</body>
</html> 